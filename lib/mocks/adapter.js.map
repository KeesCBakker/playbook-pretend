{"version":3,"sources":["../../src/mocks/adapter.js"],"names":["_this","MockAdapter","constructor","robot","name","observer","messages","get","privateMessages","run","Response","send","envelope","strings","str","record","room","unshift","push","reply","user","receive","message","Promise","resolve","enter","leave","sendPrivate","username","use"],"mappings":"AAAA,a;;AAEA;AACA,+C;AACA,sC;;AAEA,IAAIA,KAAJ,C,CAAU;;AAEV;;;AAGA,MAAMC,WAAN,qBAAkC;AAChC;;;;;AAKAC,cAAaC,KAAb,EAAoB;AAClB,UAAMA,KAAN;AACAH,YAAQ,IAAR;AACA,SAAKI,IAAL,GAAY,SAAZ;AACA,SAAKC,QAAL,GAAgB,uBAAa,EAAb,CAAhB;AACA,SAAKC,QAAL,GAAgB,KAAKD,QAAL,CAAcE,GAAd,EAAhB;AACA,SAAKC,eAAL,GAAuB,EAAvB;AACD;;AAED;;;AAGAC,QAAO;AACL,SAAKN,KAAL,CAAWO,QAAX;AACD;;AAED;;;;;;AAMAC,OAAMC,QAAN,EAAgB,GAAGC,OAAnB,EAA4B;AAC1B,SAAK,IAAIC,GAAT,IAAgBD,OAAhB,EAAyB;AACvB,UAAIE,SAAS,CAAC,OAAD,EAAUD,GAAV,CAAb;AACA,UAAIF,SAASI,IAAT,IAAiB,IAArB,EAA2BD,OAAOE,OAAP,CAAeL,SAASI,IAAxB;AAC3BhB,YAAMM,QAAN,CAAeY,IAAf,CAAoBH,MAApB;AACD;AACF;;AAED;;;;;AAKAI,QAAOP,QAAP,EAAiB,GAAGC,OAApB,EAA6B;AAC3B,SAAK,IAAIC,GAAT,IAAgBD,OAAhB,EAAyB;AACvB,UAAIE,SAAS,CAAC,OAAD,EAAW,IAAGH,SAASQ,IAAT,CAAchB,IAAK,IAAGU,GAAI,EAAxC,CAAb;AACA,UAAIF,SAASI,IAAT,IAAiB,IAArB,EAA2BD,OAAOE,OAAP,CAAeL,SAASI,IAAxB;AAC3BhB,YAAMM,QAAN,CAAeY,IAAf,CAAoBH,MAApB;AACD;AACF;;AAED;;;;;;AAMAM,UAASD,IAAT,EAAeE,OAAf,EAAwB;AACtB,WAAO,IAAIC,OAAJ,CAAYC,WAAW;AAC5B,UAAIT,SAAS,CAACK,KAAKhB,IAAN,EAAYkB,OAAZ,CAAb;AACA,UAAIF,KAAKJ,IAAL,IAAa,IAAjB,EAAuBD,OAAOE,OAAP,CAAeG,KAAKJ,IAApB;AACvB,WAAKV,QAAL,CAAcY,IAAd,CAAmBH,MAAnB;AACA,aAAO,KAAKZ,KAAL,CAAWkB,OAAX,CAAmB,oBAAgBD,IAAhB,EAAsBE,OAAtB,CAAnB,EAAmDE,OAAnD,CAAP;AACD,KALM,CAAP;AAMD;;AAED;;;;;AAKAC,QAAOL,IAAP,EAAa;AACX,WAAO,IAAIG,OAAJ,CAAYC,WAAW;AAC5B,aAAO,KAAKrB,KAAL,CAAWkB,OAAX,CAAmB,qBAAiBD,IAAjB,CAAnB,EAA2CI,OAA3C,CAAP;AACD,KAFM,CAAP;AAGD;;AAED;;;;;AAKAE,QAAON,IAAP,EAAa;AACX,WAAO,IAAIG,OAAJ,CAAYC,WAAW;AAC5B,aAAO,KAAKrB,KAAL,CAAWkB,OAAX,CAAmB,qBAAiBD,IAAjB,CAAnB,EAA2CI,OAA3C,CAAP;AACD,KAFM,CAAP;AAGD;;AAED;;;;;AAKAG,cAAaf,QAAb,EAAuB,GAAGC,OAA1B,EAAmC;AACjC,QAAIe,WAAWhB,SAASQ,IAAT,CAAchB,IAA7B;AACA,QAAI,CAAC,KAAKI,eAAL,CAAqBoB,QAArB,CAAL,EAAqC,KAAKpB,eAAL,CAAqBoB,QAArB,IAAiC,EAAjC;AACrC,SAAK,IAAId,GAAT,IAAgBD,OAAhB,EAAyB,KAAKL,eAAL,CAAqBoB,QAArB,EAA+BV,IAA/B,CAAoCJ,GAApC;AAC1B,GA/F+B,C;;;AAkGnB;AACbe,OAAK,UAAU1B,KAAV,EAAiB;AACpB,WAAO,IAAIF,WAAJ,CAAgBE,KAAhB,CAAP;AACD,GAHY,E","file":"adapter.js","sourcesContent":["'use strict'\n\nimport { Adapter, TextMessage, EnterMessage, LeaveMessage } from 'hubot-async/es2015'\nimport Observer from '../modules/observer'\nimport MockResponse from './response'\n\nlet _this // to be adapter's `this`, for when method's `this` is bound to robot\n\n/**\n * Extends Hubot Adapter, routing messages to internal collections\n */\nclass MockAdapter extends Adapter {\n  /**\n   * Create mock adapter instance\n  * @param  {Robot} @robot The robot instance\n  * @return MockAdapter    A new mock adapter\n  */\n  constructor (robot) {\n    super(robot)\n    _this = this\n    this.name = 'pretend'\n    this.observer = new Observer([])\n    this.messages = this.observer.get()\n    this.privateMessages = []\n  }\n\n  /**\n   * Invoked by robot when running, for adapter to extend bot\n   */\n  run () {\n    this.robot.Response = MockResponse\n  }\n\n  /**\n   * Record details of a send from hubot\n   * NB: robot.send calls adapter.send with this bound to robot\n   * @param  {Object} envelope   A Object with message, room and user details\n   * @param  {array} strings...  One or more Strings for each message to send\n  */\n  send (envelope, ...strings) {\n    for (let str of strings) {\n      let record = ['hubot', str]\n      if (envelope.room != null) record.unshift(envelope.room)\n      _this.messages.push(record)\n    }\n  }\n\n  /**\n   * Process and record details of a reply from hubot - prepends '@user '\n   * @param  {Object} envelope   A Object with message, room and user details\n   * @param  {array} strings...  One or more Strings for each message to send\n  */\n  reply (envelope, ...strings) {\n    for (let str of strings) {\n      let record = ['hubot', `@${envelope.user.name} ${str}`]\n      if (envelope.room != null) record.unshift(envelope.room)\n      _this.messages.push(record)\n    }\n  }\n\n  /**\n   * Process and record details of received message\n   * @param  {MockUser} user    Sender's user object\n   * @param  {string}   message Message text\n   * @return Promise            Promise resolving when robot finished processing\n  */\n  receive (user, message) {\n    return new Promise(resolve => {\n      let record = [user.name, message]\n      if (user.room != null) record.unshift(user.room)\n      this.messages.push(record)\n      return this.robot.receive(new TextMessage(user, message), resolve)\n    })\n  }\n\n  /**\n   * Process an enter message from user (not stored in messages)\n   * @param  {User} user The entering user (assumes with room set)\n   * @return {Promise}   Promise resolving when receive middleware complete\n   */\n  enter (user) {\n    return new Promise(resolve => {\n      return this.robot.receive(new EnterMessage(user), resolve)\n    })\n  }\n\n  /**\n   * Process a leave message from user (not stored in messages)\n   * @param  {User} user The leaving user (assumes with room set)\n   * @return {Promise}   Promise resolving when receive middleware complete\n   */\n  leave (user) {\n    return new Promise(resolve => {\n      return this.robot.receive(new LeaveMessage(user), resolve)\n    })\n  }\n\n  /**\n   * Custom method used by some platform adapters to process private messages\n   * @param  {Object} envelope   A Object with message, room and user details\n   * @param  {array} strings...  One or more Strings for each message to send\n   */\n  sendPrivate (envelope, ...strings) {\n    let username = envelope.user.name\n    if (!this.privateMessages[username]) this.privateMessages[username] = []\n    for (let str of strings) this.privateMessages[username].push(str)\n  }\n}\n\nexport default {\n  use: function (robot) {\n    return new MockAdapter(robot)\n  }\n}\n"]}